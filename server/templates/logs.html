{% extends "base.html" %}
{% block title %}Logs â€” LEAKCHECK Admin{% endblock %}
{% block content %}
<h1>ðŸ“‹ Activity Logs</h1>

<div class="form-row mb-2">
    <a href="{{ url_for('admin_web.logs_page', limit=50) }}" class="btn btn-info btn-sm">Last 50</a>
    <a href="{{ url_for('admin_web.logs_page', limit=100) }}" class="btn btn-info btn-sm">Last 100</a>
    <a href="{{ url_for('admin_web.logs_page', limit=500) }}" class="btn btn-info btn-sm">Last 500</a>
</div>

<h2>Activity ({{ activity|length }})</h2>
<table>
    <thead>
        <tr><th>Time</th><th>User Key</th><th>Action</th><th>Detail</th><th>IP</th><th>Duration</th></tr>
    </thead>
    <tbody>
        {% for a in activity %}
        <tr>
            <td class="text-dim text-sm">{{ "%.0f"|format(a.timestamp) | int }}</td>
            <td class="text-dim text-sm mono truncate">{{ a.user_key[:16] }}...</td>
            <td>{{ a.action }}</td>
            <td class="text-sm" style="max-width:300px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">{{ a.detail }}</td>
            <td class="text-dim">{{ a.ip }}</td>
            <td class="text-dim">{{ "%.0f"|format(a.duration_ms) }}ms</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h2>Uploads ({{ uploads|length }})</h2>
<table>
    <thead>
        <tr><th>Time</th><th>User Key</th><th>File</th><th>Records</th><th>New</th><th>IP</th></tr>
    </thead>
    <tbody>
        {% for u in uploads %}
        <tr>
            <td class="text-dim text-sm">{{ "%.0f"|format(u.timestamp) | int }}</td>
            <td class="text-dim text-sm mono truncate">{{ u.user_key[:16] }}...</td>
            <td>{{ u.filename }}</td>
            <td>{{ "{:,}".format(u.record_count) }}</td>
            <td style="color:var(--green);">{{ "{:,}".format(u.new_count) }}</td>
            <td class="text-dim">{{ u.ip }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
